<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Art Explorer</title>
    <link rel="icon" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='80' height='80' viewBox='0 0 80 80'%3E%3Ccircle cx='40' cy='40' r='30' fill='%23FFD700'/%3E%3C/svg%3E">
    <style>
        body {
            background-color: white;
            color: black;
            font-family: 'Helvetica Neue', Arial, sans-serif;
            text-align: center;
            margin: 0;
            padding: 60px 20px 40px;
            line-height: 1.5;
        }
        #header {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            background-color: white;
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px 20px;
            box-sizing: border-box;
            z-index: 10;
        }
        #logo {
            width: 80px;
            height: 80px;
        }
        .dropdown {
            position: relative;
            display: inline-block;
        }
        .dropbtn {
            background-color: white;
            color: black;
            padding: 2px 6px;
            font-size: 11px;
            border: 1px solid #ddd;
            border-radius: 4px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            min-width: 70px;
            text-align: center;
        }
        .dropdown-content {
            display: none;
            position: absolute;
            background-color: white;
            min-width: 90px;
            box-shadow: 0px 8px 16px 0px rgba(0,0,0,0.2);
            z-index: 1;
            border: 1px solid #ddd;
            border-radius: 4px;
            left: 50%;
            transform: translateX(-50%);
            max-height: 150px;
            overflow-y: auto;
        }
        .dropdown-content a {
            color: black;
            padding: 4px 6px;
            text-decoration: none;
            display: block;
            font-size: 11px;
        }
        .dropdown-content a:hover {
            background-color: #f1f1f1;
        }
        .dropdown.show .dropdown-content {
            display: block;
        }
        #art {
            max-width: 90%;
            max-height: 50vh;
            margin: 40px auto 20px;
            display: block;
            transition: opacity 0.5s ease-in;
        }
        #art.loading {
            opacity: 0.5;
        }
        #title {
            font-size: 24px;
            margin: 10px 0;
            font-weight: 500;
        }
        #title.loading .skeleton {
            background: #eee;
            height: 24px;
            width: 60%;
            margin: 0 auto;
            animation: pulse 1.5s ease-in-out infinite;
        }
        #artist {
            font-size: 18px;
            margin: 10px 0 30px;
            color: #666;
        }
        #artist.loading .skeleton {
            background: #eee;
            height: 18px;
            width: 40%;
            margin: 0 auto;
            animation: pulse 1.5s ease-in-out infinite;
        }
        #toggle-container {
            display: flex;
            justify-content: center;
            align-items: center;
            margin: 0 0 30px;
            position: relative;
            height: 24px;
        }
        #toggle-indicator {
            cursor: pointer;
            position: absolute;
            background-color: #000;
            border-radius: 50%;
            transition: width 0.3s ease, height 0.3s ease, transform 0.3s ease;
        }
        #desc {
            font-size: 16px;
            margin: 10px auto 40px;
            max-width: 600px;
            opacity: 1;
            transition: opacity 0.3s ease, filter 0.3s ease;
        }
        #desc.loading {
            opacity: 0.3;
            filter: blur(2px);
        }
        #desc .skeleton {
            background: #eee;
            height: 16px;
            margin: 8px 0;
            animation: pulse 1.5s ease-in-out infinite;
        }
        #value {
            font-size: 16px;
            margin: 10px 0;
            opacity: 1;
            transition: opacity 0.3s ease, filter 0.3s ease;
        }
        #value.loading {
            opacity: 0.3;
            filter: blur(2px);
        }
        #value .skeleton {
            display: inline-block;
            background: #eee;
            width: 150px;
            height: 16px;
            animation: pulse 1.5s ease-in-out infinite;
        }
        #justification-container {
            margin-top: 10px;
            text-align: center;
            transition: opacity 0.3s ease, filter 0.3s ease;
        }
        #justification-container.loading {
            opacity: 0.3;
            filter: blur(2px);
        }
        #justification-toggle {
            background: none;
            border: none;
            font-size: 14px;
            color: #666;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto;
        }
        #justification-toggle::after {
            content: '▼';
            font-size: 12px;
            margin-left: 5px;
            transition: transform 0.2s;
        }
        #justification-toggle.open::after {
            transform: rotate(180deg);
        }
        #justification {
            font-size: 14px;
            color: #666;
            margin-top: 10px;
            max-width: 600px;
            margin-left: auto;
            margin-right: auto;
            display: none;
        }
        #controls {
            margin-top: 30px;
        }
        #controls button {
            background: none;
            border: none;
            font-size: 28px;
            cursor: pointer;
            color: black;
            margin: 0 30px;
            transition: color 0.2s;
        }
        #controls button:hover {
            color: #666;
        }
        #controls button:disabled {
            color: #ccc;
            cursor: not-allowed;
        }
        #disclosure {
            font-size: 12px;
            color: #888;
            margin-top: 50px;
            padding: 20px;
            text-align: center;
        }
        #selects {
            display: flex;
            gap: 10px;
            align-items: center;
        }
        @keyframes pulse {
            0% { background-color: #eee; }
            50% { background-color: #ddd; }
            100% { background-color: #eee; }
        }
        @media (max-width: 600px) {
            body {
                padding: 60px 10px 40px;
            }
            #title {
                font-size: 20px;
            }
            #artist {
                font-size: 16px;
            }
            #desc {
                font-size: 14px;
            }
            #value {
                font-size: 14px;
            }
            #controls button {
                font-size: 24px;
                margin: 0 15px;
            }
        }
    </style>
</head>
<body>
    <div id="header">
        <img id="logo" src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='80' height='80' viewBox='0 0 80 80'%3E%3Ccircle cx='40' cy='40' r='30' fill='%23FFD700'/%3E%3C/svg%3E" alt="Golden Dot Logo">
        <div id="selects">
            <div id="category-dropdown" class="dropdown">
                <button class="dropbtn" id="category-button">Random</button>
                <div class="dropdown-content" id="category-content">
                    <!-- Categories will be populated here -->
                </div>
            </div>
            <div id="lang-dropdown" class="dropdown">
                <button class="dropbtn" id="lang-button">English</button>
                <div class="dropdown-content">
                    <a href="#" data-value="af">Afrikaans</a>
                    <a href="#" data-value="sq">Albanian</a>
                    <a href="#" data-value="am">Amharic</a>
                    <a href="#" data-value="ar">Arabic</a>
                    <a href="#" data-value="hy">Armenian</a>
                    <a href="#" data-value="az">Azerbaijani</a>
                    <a href="#" data-value="eu">Basque</a>
                    <a href="#" data-value="be">Belarusian</a>
                    <a href="#" data-value="bn">Bengali</a>
                    <a href="#" data-value="bs">Bosnian</a>
                    <a href="#" data-value="bg">Bulgarian</a>
                    <a href="#" data-value="ca">Catalan</a>
                    <a href="#" data-value="ceb">Cebuano</a>
                    <a href="#" data-value="ny">Chichewa</a>
                    <a href="#" data-value="zh">Chinese (Simplified)</a>
                    <a href="#" data-value="zh-TW">Chinese (Traditional)</a>
                    <a href="#" data-value="co">Corsican</a>
                    <a href="#" data-value="hr">Croatian</a>
                    <a href="#" data-value="cs">Czech</a>
                    <a href="#" data-value="da">Danish</a>
                    <a href="#" data-value="nl">Dutch</a>
                    <a href="#" data-value="en">English</a>
                    <a href="#" data-value="eo">Esperanto</a>
                    <a href="#" data-value="et">Estonian</a>
                    <a href="#" data-value="tl">Filipino</a>
                    <a href="#" data-value="fi">Finnish</a>
                    <a href="#" data-value="fr">French</a>
                    <a href="#" data-value="fy">Frisian</a>
                    <a href="#" data-value="gl">Galician</a>
                    <a href="#" data-value="ka">Georgian</a>
                    <a href="#" data-value="de">German</a>
                    <a href="#" data-value="el">Greek</a>
                    <a href="#" data-value="gu">Gujarati</a>
                    <a href="#" data-value="ht">Haitian Creole</a>
                    <a href="#" data-value="ha">Hausa</a>
                    <a href="#" data-value="haw">Hawaiian</a>
                    <a href="#" data-value="iw">Hebrew</a>
                    <a href="#" data-value="hi">Hindi</a>
                    <a href="#" data-value="hmn">Hmong</a>
                    <a href="#" data-value="hu">Hungarian</a>
                    <a href="#" data-value="is">Icelandic</a>
                    <a href="#" data-value="ig">Igbo</a>
                    <a href="#" data-value="id">Indonesian</a>
                    <a href="#" data-value="ga">Irish</a>
                    <a href="#" data-value="it">Italian</a>
                    <a href="#" data-value="ja">Japanese</a>
                    <a href="#" data-value="jw">Javanese</a>
                    <a href="#" data-value="kn">Kannada</a>
                    <a href="#" data-value="kk">Kazakh</a>
                    <a href="#" data-value="km">Khmer</a>
                    <a href="#" data-value="ko">Korean</a>
                    <a href="#" data-value="ku">Kurdish (Kurmanji)</a>
                    <a href="#" data-value="ky">Kyrgyz</a>
                    <a href="#" data-value="lo">Lao</a>
                    <a href="#" data-value="la">Latin</a>
                    <a href="#" data-value="lv">Latvian</a>
                    <a href="#" data-value="lt">Lithuanian</a>
                    <a href="#" data-value="lb">Luxembourgish</a>
                    <a href="#" data-value="mk">Macedonian</a>
                    <a href="#" data-value="mg">Malagasy</a>
                    <a href="#" data-value="ms">Malay</a>
                    <a href="#" data-value="ml">Malayalam</a>
                    <a href="#" data-value="mt">Maltese</a>
                    <a href="#" data-value="mi">Maori</a>
                    <a href="#" data-value="mr">Marathi</a>
                    <a href="#" data-value="mn">Mongolian</a>
                    <a href="#" data-value="my">Myanmar (Burmese)</a>
                    <a href="#" data-value="ne">Nepali</a>
                    <a href="#" data-value="no">Norwegian</a>
                    <a href="#" data-value="ps">Pashto</a>
                    <a href="#" data-value="fa">Persian</a>
                    <a href="#" data-value="pl">Polish</a>
                    <a href="#" data-value="pt">Portuguese</a>
                    <a href="#" data-value="pa">Punjabi</a>
                    <a href="#" data-value="ro">Romanian</a>
                    <a href="#" data-value="ru">Russian</a>
                    <a href="#" data-value="sm">Samoan</a>
                    <a href="#" data-value="gd">Scots Gaelic</a>
                    <a href="#" data-value="sr">Serbian</a>
                    <a href="#" data-value="st">Sesotho</a>
                    <a href="#" data-value="sn">Shona</a>
                    <a href="#" data-value="sd">Sindhi</a>
                    <a href="#" data-value="si">Sinhala</a>
                    <a href="#" data-value="sk">Slovak</a>
                    <a href="#" data-value="sl">Slovenian</a>
                    <a href="#" data-value="so">Somali</a>
                    <a href="#" data-value="es">Spanish</a>
                    <a href="#" data-value="su">Sundanese</a>
                    <a href="#" data-value="sw">Swahili</a>
                    <a href="#" data-value="sv">Swedish</a>
                    <a href="#" data-value="tg">Tajik</a>
                    <a href="#" data-value="ta">Tamil</a>
                    <a href="#" data-value="te">Telugu</a>
                    <a href="#" data-value="th">Thai</a>
                    <a href="#" data-value="tr">Turkish</a>
                    <a href="#" data-value="uk">Ukrainian</a>
                    <a href="#" data-value="ur">Urdu</a>
                    <a href="#" data-value="uz">Uzbek</a>
                    <a href="#" data-value="vi">Vietnamese</a>
                    <a href="#" data-value="cy">Welsh</a>
                    <a href="#" data-value="xh">Xhosa</a>
                    <a href="#" data-value="yi">Yiddish</a>
                    <a href="#" data-value="yo">Yoruba</a>
                    <a href="#" data-value="zu">Zulu</a>
                </div>
            </div>
        </div>
    </div>
    <img id="art" src="" alt="Artwork">
    <h2 id="title"></h2>
    <p id="artist"></p>
    <div id="toggle-container">
        <div id="toggle-indicator"></div>
    </div>
    <p id="desc"></p>
    <p id="value">If we really had to price it: </p>
    <div id="justification-container">
        <button id="justification-toggle">How did we determine this?</button>
        <p id="justification"></p>
    </div>
    <div id="controls">
        <button id="prev" aria-label="Previous Artwork">←</button>
        <button id="next" aria-label="Next Artwork">→</button>
    </div>
    <div id="disclosure">
        All artworks are sourced from The Metropolitan Museum of Art's public collection API. This site is not affiliated with, endorsed by, or sponsored by The Metropolitan Museum of Art. We gratefully acknowledge The Met for providing open access to their collection data.
    </div>
    <script>
        const DEEPSEEK_API_KEY = 'sk-457f3a9291c74e9589c87eb822c98ae6'; // Replace with your actual DeepSeek API key
        let objectIDs = [];
        let history = [];
        let currentIndex = -1;
        let shortDesc = '';
        let longDesc = '';
        let shortJustification = '';
        let longJustification = '';
        let preferredLength = 'long'; // Default to long
        let currentLang = 'en';
        let isJustificationExpanded = false;
        let rawRange = '';
        let rawSingle = '';
        let originalDisclosure = "All artworks are sourced from The Metropolitan Museum of Art's public collection API. This site is not affiliated with, endorsed by, or sponsored by The Metropolitan Museum of Art. We gratefully acknowledge The Met for providing open access to their collection data.";
        let departments = [];
        async function fetchDepartments() {
            try {
                const response = await fetch('https://collectionapi.metmuseum.org/public/collection/v1/departments');
                const data = await response.json();
                departments = data.departments;
                const content = document.getElementById('category-content');
                const randomA = document.createElement('a');
                randomA.href = '#';
                randomA.dataset.value = '0';
                randomA.textContent = 'Random';
                content.appendChild(randomA);
                departments.forEach(dept => {
                    const a = document.createElement('a');
                    a.href = '#';
                    a.dataset.value = dept.departmentId;
                    a.textContent = dept.displayName;
                    content.appendChild(a);
                });
                // Add event listeners to category options
                const categoryOptions = content.querySelectorAll('a');
                categoryOptions.forEach(option => {
                    option.addEventListener('click', async function(e) {
                        e.preventDefault();
                        const departmentId = parseInt(this.dataset.value);
                        document.getElementById('category-button').textContent = this.textContent;
                        document.getElementById('category-dropdown').classList.remove('show');
                        history = [];
                        currentIndex = -1;
                        await fetchObjectIDs(departmentId);
                        randomArt();
                    });
                });
            } catch (error) {
                console.error('Error fetching departments:', error);
            }
        }
        async function fetchObjectIDs(departmentId = 0) {
            try {
                let url = 'https://collectionapi.metmuseum.org/public/collection/v1/objects';
                if (departmentId !== 0) {
                    url += `?departmentIds=${departmentId}`;
                }
                const response = await fetch(url);
                const data = await response.json();
                objectIDs = data.objectIDs;
            } catch (error) {
                console.error('Error fetching object IDs:', error);
            }
        }
        async function loadArt(id) {
            // Set loading states
            const artElem = document.getElementById('art');
            artElem.classList.add('loading');
          
            const titleElem = document.getElementById('title');
            titleElem.innerHTML = '<div class="skeleton"></div>';
            titleElem.classList.add('loading');
          
            const artistElem = document.getElementById('artist');
            artistElem.innerHTML = '<div class="skeleton"></div>';
            artistElem.classList.add('loading');
          
            const descElem = document.getElementById('desc');
            descElem.innerHTML = '<div class="skeleton" style="width: 100%;"></div><div class="skeleton" style="width: 90%;"></div><div class="skeleton" style="width: 70%;"></div>';
            descElem.classList.add('loading');
          
            const valueElem = document.getElementById('value');
            valueElem.innerHTML = 'If we really had to price it: <span class="skeleton"></span>';
            valueElem.classList.add('loading');
          
            const justificationContainer = document.getElementById('justification-container');
            justificationContainer.classList.add('loading');
          
            const justificationElem = document.getElementById('justification');
            justificationElem.innerHTML = '<div class="skeleton" style="width: 100%;"></div><div class="skeleton" style="width: 90%;"></div><div class="skeleton" style="width: 70%;"></div>';
          
            try {
                const response = await fetch(`https://collectionapi.metmuseum.org/public/collection/v1/objects/${id}`);
                const data = await response.json();
                if (!data.primaryImage) {
                    randomArt(); // Retry if no image
                    return;
                }
                artElem.src = data.primaryImage;
                artElem.classList.remove('loading');
              
                titleElem.textContent = data.title || 'Untitled';
                titleElem.classList.remove('loading');
              
                artistElem.textContent = data.artistDisplayName || 'Unknown Artist';
                artistElem.classList.remove('loading');
             
                // Generate descriptions
                [shortDesc, longDesc] = await Promise.all([
                    generateShortDescriptionWithAI(data),
                    generateLongDescriptionWithAI(data)
                ]);
                descElem.classList.remove('loading');
                await updateDescription();
             
                // Generate value, single
                const range = await getEstimatedRangeWithAI(data);
                const single = await getSinglePriceWithAI(data, range);
                rawRange = range;
                rawSingle = single;
                valueElem.classList.remove('loading');
                valueElem.textContent = await translateStatic('If we really had to price it') + ': ' + rawSingle;
             
                // Now generate justifications after pricing
                [shortJustification, longJustification] = await Promise.all([
                    generateShortJustificationWithAI(data),
                    generateLongJustificationWithAI(data)
                ]);
                await updateJustification();
                justificationContainer.classList.remove('loading');
                // Reset dropdown but keep expanded state
                const toggle = document.getElementById('justification-toggle');
                toggle.textContent = await translateStatic('How did we determine this?');
                const justification = document.getElementById('justification');
                if (isJustificationExpanded) {
                    toggle.classList.add('open');
                    justification.style.display = 'block';
                } else {
                    toggle.classList.remove('open');
                    justification.style.display = 'none';
                }
                // Update buttons
                document.getElementById('prev').disabled = currentIndex <= 0;
                // Set toggle state
                updateToggleState();
                updateToggleVisibility();
                // Translate disclosure
                document.getElementById('disclosure').textContent = await translateStatic(originalDisclosure);
            } catch (error) {
                console.error('Error fetching object:', error);
                document.getElementById('desc').textContent = 'Error loading description.';
                document.getElementById('value').textContent = 'If we really had to price it: Not available';
                document.getElementById('justification').textContent = '';
                // Remove loading classes
                artElem.classList.remove('loading');
                titleElem.classList.remove('loading');
                artistElem.classList.remove('loading');
                descElem.classList.remove('loading');
                valueElem.classList.remove('loading');
                justificationContainer.classList.remove('loading');
            }
        }
        async function generateShortDescriptionWithAI(data) {
            const details = dataToDetails(data);
            const prompt = `Based on the following metadata about an artwork, write a conversational, interesting, and story-like short paragraph (2-4 sentences) that is easy to read. Make it professional and polite, incorporating interesting facts and highlighting aspects like history, creation, or trivia. Strictly keep the entire paragraph under 400 characters. Do not mention that it is part of The Met’s collection. Do not include any character count, length note, or meta information. Do not use any special formatting like bold, italics, asterisks, or phrases that reference this prompt. Use plain text only, but emojis are allowed if appropriate:\n\n${details}`;
            return await callDeepSeekAPI(prompt);
        }
        async function generateLongDescriptionWithAI(data) {
            const details = dataToDetails(data);
            const prompt = `Based on the following metadata about an artwork, write a conversational, interesting, and story-like paragraph (3-6 sentences) that is easy to read. Make it professional and polite, incorporating interesting facts and highlighting aspects like history, creation, or trivia. Keep the paragraph under 1000 characters. Do not mention that it is part of The Met’s collection. Do not include any character count, length note, or meta information. Do not use any special formatting like bold, italics, asterisks, or phrases that reference this prompt. Use plain text only, but emojis are allowed if appropriate:\n\n${details}`;
            return await callDeepSeekAPI(prompt);
        }
        async function generateShortJustificationWithAI(data) {
            const details = dataToDetails(data);
            const prompt = `Based on the following metadata about an artwork, provide a short justification (2-3 sentences, up to 200 characters) for the estimated market value, explaining the basis like similar sales, artist reputation, rarity, condition, and market trends. Do not include any character count, length note, or meta information. Use plain text only:\n\n${details}`;
            return await callDeepSeekAPI(prompt);
        }
        async function generateLongJustificationWithAI(data) {
            const details = dataToDetails(data);
            const prompt = `Based on the following metadata about an artwork, provide a justification (3-5 sentences, up to 400 characters) for the estimated market value, explaining the basis like similar sales, artist reputation, rarity, condition, and market trends. Do not include any character count, length note, or meta information. Use plain text only:\n\n${details}`;
            return await callDeepSeekAPI(prompt);
        }
        async function getEstimatedRangeWithAI(data) {
            const details = dataToDetails(data);
            const prompt = `Based on the following metadata about an artwork, output ONLY the estimated market value range (e.g., $10,000 - $50,000). Use the details to identify the artwork accurately and base your estimate on known sales of similar works, artist reputation, rarity, condition, and market trends. You must provide a range, even if approximate; if very little is known, give a broad range based on comparable items. Do not include any explanation or additional text:\n\n${details}`;
            return await callDeepSeekAPI(prompt);
        }
        async function getSinglePriceWithAI(data, range) {
            const details = dataToDetails(data);
            const prompt = `Given the estimated value range of ${range} for the artwork with the following metadata, output ONLY a single estimated market value that is strictly within this range (e.g., if range is $10,000 - $50,000, something like $25,000). Choose a reasonable point based on factors like artist reputation, rarity, etc., not necessarily the exact midpoint. Do not include any explanation or additional text:\n\n${details}`;
            return await callDeepSeekAPI(prompt);
        }
        function dataToDetails(data) {
            return `
Title: ${data.title || 'Untitled'}
Artist: ${data.artistDisplayName || 'Unknown Artist'}
Date: ${data.objectDate || 'Unknown'}
Medium: ${data.medium || 'Unknown'}
Culture: ${data.culture || 'Unknown'}
Classification: ${data.classification || 'Unknown'}
Dimensions: ${data.dimensions || 'Unknown'}
Period: ${data.period || 'Unknown'}
Dynasty: ${data.dynasty || 'Unknown'}
Reign: ${data.reign || 'Unknown'}
Portfolio: ${data.portfolio || 'Unknown'}
Constituent ID: ${data.constituentID || 'Unknown'}
Artist Role: ${data.artistRole || 'Unknown'}
Artist Prefix: ${data.artistPrefix || 'Unknown'}
Artist Display Bio: ${data.artistDisplayBio || 'Unknown'}
Artist Suffix: ${data.artistSuffix || 'Unknown'}
Artist Alpha Sort: ${data.artistAlphaSort || 'Unknown'}
Artist Nationality: ${data.artistNationality || 'Unknown'}
Artist Begin Date: ${data.artistBeginDate || 'Unknown'}
Artist End Date: ${data.artistEndDate || 'Unknown'}
Artist Gender: ${data.artistGender || 'Unknown'}
Artist Wikidata URL: ${data.artistWikidataURL || 'Unknown'}
Artist ULAN URL: ${data.artistULANURL || 'Unknown'}
Object Name: ${data.objectName || 'Unknown'}
Object Begin Date: ${data.objectBeginDate || 'Unknown'}
Object End Date: ${data.objectEndDate || 'Unknown'}
Credit Line: ${data.creditLine || 'Unknown'}
Geography Type: ${data.geographyType || 'Unknown'}
City: ${data.city || 'Unknown'}
State: ${data.state || 'Unknown'}
County: ${data.county || 'Unknown'}
Country: ${data.country || 'Unknown'}
Region: ${data.region || 'Unknown'}
Subregion: ${data.subregion || 'Unknown'}
Locale: ${data.locale || 'Unknown'}
Locus: ${data.locus || 'Unknown'}
Excavation: ${data.excavation || 'Unknown'}
River: ${data.river || 'Unknown'}
Rights and Reproduction: ${data.rightsAndReproduction || 'Unknown'}
Link Resource: ${data.linkResource || 'Unknown'}
Object Wikidata URL: ${data.objectWikidataURL || 'Unknown'}
Metadata Date: ${data.metadataDate || 'Unknown'}
Repository: ${data.repository || 'Unknown'}
Tags: ${data.tags ? data.tags.map(tag => tag.term).join(', ') : 'None'}
            `.trim();
        }
        async function callDeepSeekAPI(prompt) {
            if (!DEEPSEEK_API_KEY || DEEPSEEK_API_KEY === 'your-deepseek-api-key-here') {
                return 'API key not set. Please add your DeepSeek API key.';
            }
            try {
                const response = await fetch('https://api.deepseek.com/chat/completions', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${DEEPSEEK_API_KEY}`
                    },
                    body: JSON.stringify({
                        model: 'deepseek-chat',
                        messages: [
                            { role: 'system', content: 'You are a helpful assistant specializing in art history and valuation.' },
                            { role: 'user', content: prompt }
                        ],
                        stream: false
                    })
                });
                const result = await response.json();
                return result.choices[0].message.content.trim() || 'No information available.';
            } catch (error) {
                console.error('Error calling DeepSeek API:', error);
                return 'Error generating content.';
            }
        }
        async function updateDescription() {
            let text = preferredLength === 'long' ? longDesc : shortDesc;
            if (currentLang !== 'en') {
                text = await translateText(text, 'en', currentLang);
            }
            document.getElementById('desc').textContent = text;
        }
        async function updateJustification() {
            let justificationText = preferredLength === 'long' ? longJustification : shortJustification;
            let translatedLabel = await translateStatic('Estimated value range');
            let translatedJust = currentLang === 'en' ? justificationText : await translateText(justificationText, 'en', currentLang);
            let fullText = `<div style="text-align: center; margin-bottom: 10px;">${translatedLabel}: ${rawRange}</div>${translatedJust}`;
            document.getElementById('justification').innerHTML = fullText;
        }
        async function translateText(text, from, to) {
            try {
                const response = await fetch(`https://translate.googleapis.com/translate_a/single?client=gtx&sl=${from}&tl=${to}&dt=t&q=${encodeURIComponent(text)}`);
                const data = await response.json();
                let translated = '';
                data[0].forEach(part => {
                    translated += part[0];
                });
                return translated || text;
            } catch (error) {
                console.error('Error translating:', error);
                return text;
            }
        }
        async function translateStatic(text) {
            if (currentLang === 'en') return text;
            return await translateText(text, 'en', currentLang);
        }
        async function updateLanguage() {
            document.getElementById('value').textContent = await translateStatic('If we really had to price it') + ': ' + rawSingle;
            document.getElementById('justification-toggle').textContent = await translateStatic('How did we determine this?');
            document.getElementById('disclosure').textContent = await translateStatic(originalDisclosure);
            await updateDescription();
            await updateJustification();
        }
        function randomArt() {
            if (objectIDs.length === 0) return;
            const randomIndex = Math.floor(Math.random() * objectIDs.length);
            const id = objectIDs[randomIndex];
            history.push(id);
            currentIndex = history.length - 1;
            loadArt(id);
        }
        function prevArt() {
            if (currentIndex > 0) {
                currentIndex--;
                loadArt(history[currentIndex]);
            }
        }
        function nextArt() {
            if (currentIndex < history.length - 1) {
                currentIndex++;
                loadArt(history[currentIndex]);
            } else {
                randomArt();
            }
        }
        function updateToggleVisibility() {
            const toggleContainer = document.getElementById('toggle-container');
            toggleContainer.style.display = 'flex';
        }
        function updateToggleState() {
            const indicator = document.getElementById('toggle-indicator');
            if (preferredLength === 'long') {
                indicator.style.transform = 'translateX(20px)';
                indicator.style.width = '24px';
                indicator.style.height = '24px';
            } else {
                indicator.style.transform = 'translateX(-20px)';
                indicator.style.width = '12px';
                indicator.style.height = '12px';
            }
        }
        // Event listeners
        document.getElementById('prev').addEventListener('click', prevArt);
        document.getElementById('next').addEventListener('click', nextArt);
        document.getElementById('justification-toggle').addEventListener('click', function() {
            const justification = document.getElementById('justification');
            this.classList.toggle('open');
            justification.style.display = this.classList.contains('open') ? 'block' : 'none';
            isJustificationExpanded = this.classList.contains('open');
        });
        // Custom dropdown for language
        const langDropdown = document.getElementById('lang-dropdown');
        const langDropbtn = document.getElementById('lang-button');
        langDropbtn.addEventListener('click', function() {
            langDropdown.classList.toggle('show');
            if (categoryDropdown.classList.contains('show')) {
                categoryDropdown.classList.remove('show');
            }
        });
        const langOptions = langDropdown.querySelectorAll('.dropdown-content a');
        langOptions.forEach(option => {
            option.addEventListener('click', async function(e) {
                e.preventDefault();
                currentLang = this.dataset.value;
                langDropbtn.textContent = this.textContent;
                langDropdown.classList.remove('show');
                await updateLanguage();
            });
        });
        // Custom dropdown for category
        const categoryDropdown = document.getElementById('category-dropdown');
        const categoryDropbtn = document.getElementById('category-button');
        categoryDropbtn.addEventListener('click', function() {
            categoryDropdown.classList.toggle('show');
            if (langDropdown.classList.contains('show')) {
                langDropdown.classList.remove('show');
            }
        });
        // Click outside to close dropdowns
        window.addEventListener('click', function(event) {
            if (!event.target.matches('.dropbtn')) {
                if (langDropdown.classList.contains('show')) {
                    langDropdown.classList.remove('show');
                }
                if (categoryDropdown.classList.contains('show')) {
                    categoryDropdown.classList.remove('show');
                }
            }
        });
        // Toggle click
        document.getElementById('toggle-container').addEventListener('click', async function() {
            preferredLength = preferredLength === 'long' ? 'short' : 'long';
            updateToggleState();
            await updateDescription();
            await updateJustification();
        });
        // Initialize
        fetchDepartments().then(() => fetchObjectIDs().then(randomArt));
        // Initial toggle state
        updateToggleState();
    </script>
</body>
</html>
